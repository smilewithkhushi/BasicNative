{"version":3,"sources":["../../../src/customize/generate.ts"],"sourcesContent":["import path from 'path';\nimport resolveFrom from 'resolve-from';\n\nimport { DestinationResolutionProps, selectTemplatesAsync, TEMPLATES } from './templates';\nimport { installAsync } from '../install/installAsync';\nimport { Log } from '../log';\nimport { copyAsync } from '../utils/dir';\nimport { CommandError } from '../utils/errors';\n\nexport async function queryAndGenerateAsync(\n  projectRoot: string,\n  {\n    files,\n    props,\n    extras,\n  }: {\n    files: string[];\n    props: DestinationResolutionProps;\n    /** Any extra props to pass to the install command. */\n    extras: any[];\n  }\n) {\n  const valid = files.filter(\n    (file) => !!TEMPLATES.find((template) => template.destination(props) === file)\n  );\n\n  if (valid.length !== files.length) {\n    const diff = files.filter(\n      (file) => !TEMPLATES.find((template) => template.destination(props) === file)\n    );\n    throw new CommandError(\n      `Invalid files: ${diff.join(', ')}. Allowed: ${TEMPLATES.map((template) =>\n        template.destination(props)\n      ).join(', ')}`\n    );\n  }\n\n  if (!valid.length) {\n    return;\n  }\n  Log.log(`Generating: ${valid.join(', ')}`);\n  return generateAsync(projectRoot, {\n    answer: files.map((file) =>\n      TEMPLATES.findIndex((template) => template.destination(props) === file)\n    ),\n    props,\n    extras,\n  });\n}\n\n/** Select templates to generate then generate and install. */\nexport async function selectAndGenerateAsync(\n  projectRoot: string,\n  {\n    props,\n    extras,\n  }: {\n    props: DestinationResolutionProps;\n    /** Any extra props to pass to the install command. */\n    extras: any[];\n  }\n) {\n  const answer = await selectTemplatesAsync(projectRoot, props);\n\n  if (!answer?.length) {\n    Log.exit('\\n\\u203A Exiting with no change...', 0);\n  }\n\n  await generateAsync(projectRoot, {\n    answer,\n    props,\n    extras,\n  });\n}\n\nasync function generateAsync(\n  projectRoot: string,\n  {\n    answer,\n    props,\n    extras,\n  }: {\n    answer: number[];\n    props: DestinationResolutionProps;\n    /** Any extra props to pass to the install command. */\n    extras: any[];\n  }\n) {\n  // Copy files\n  await Promise.all(\n    answer.map(async (file) => {\n      const template = TEMPLATES[file];\n\n      if (template.configureAsync) {\n        if (await template.configureAsync(projectRoot)) {\n          return;\n        }\n      }\n\n      const projectFilePath = path.resolve(projectRoot, template.destination(props));\n      // copy the file from template\n      return copyAsync(template.file(projectRoot), projectFilePath, {\n        overwrite: true,\n        recursive: true,\n      });\n    })\n  );\n\n  // Install dependencies\n  const packages = answer\n    .map((file) => TEMPLATES[file].dependencies)\n    .flat()\n    .filter((pkg) => !resolveFrom.silent(projectRoot, pkg));\n  if (packages.length) {\n    Log.debug('Installing ' + packages.join(', '));\n    await installAsync(packages, {}, ['--dev', ...extras]);\n  }\n}\n"],"names":["queryAndGenerateAsync","selectAndGenerateAsync","projectRoot","files","props","extras","valid","filter","file","TEMPLATES","find","template","destination","length","diff","CommandError","join","map","Log","log","generateAsync","answer","findIndex","selectTemplatesAsync","exit","Promise","all","configureAsync","projectFilePath","path","resolve","copyAsync","overwrite","recursive","packages","dependencies","flat","pkg","resolveFrom","silent","debug","installAsync"],"mappings":"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"}