{"version":3,"sources":["../../../../src/run/ios/launchApp.ts"],"sourcesContent":["import chalk from 'chalk';\nimport path from 'path';\n\nimport * as XcodeBuild from './XcodeBuild';\nimport { BuildProps } from './XcodeBuild.types';\nimport { getAppDeltaDirectory, installOnDeviceAsync } from './appleDevice/installOnDeviceAsync';\nimport { AppleDeviceManager } from '../../start/platforms/ios/AppleDeviceManager';\nimport { launchBinaryOnMacAsync } from '../../start/platforms/ios/devicectl';\nimport { SimulatorLogStreamer } from '../../start/platforms/ios/simctlLogging';\nimport { DevServerManager } from '../../start/server/DevServerManager';\nimport { parsePlistAsync } from '../../utils/plist';\nimport { profile } from '../../utils/profile';\n\n/** Install and launch the app binary on a device. */\nexport async function launchAppAsync(\n  binaryPath: string,\n  manager: DevServerManager,\n  props: Pick<BuildProps, 'isSimulator' | 'device' | 'shouldStartBundler'>\n) {\n  const appId = await profile(getBundleIdentifierForBinaryAsync)(binaryPath);\n\n  if (!props.isSimulator) {\n    if (props.device.osType === 'macOS') {\n      await launchBinaryOnMacAsync(appId, binaryPath);\n    } else {\n      await profile(installOnDeviceAsync)({\n        bundleIdentifier: appId,\n        bundle: binaryPath,\n        appDeltaDirectory: getAppDeltaDirectory(appId),\n        udid: props.device.udid,\n        deviceName: props.device.name,\n      });\n    }\n\n    return;\n  }\n\n  XcodeBuild.logPrettyItem(chalk`{bold Installing} on ${props.device.name}`);\n\n  const device = await AppleDeviceManager.resolveAsync({ device: props.device });\n  await device.installAppAsync(binaryPath);\n\n  XcodeBuild.logPrettyItem(chalk`{bold Opening} on ${device.name} {dim (${appId})}`);\n\n  if (props.shouldStartBundler) {\n    await SimulatorLogStreamer.getStreamer(device.device, {\n      appId,\n    }).attachAsync();\n  }\n\n  await manager.getDefaultDevServer().openCustomRuntimeAsync(\n    'simulator',\n    {\n      applicationId: appId,\n    },\n    { device }\n  );\n}\n\nasync function getBundleIdentifierForBinaryAsync(binaryPath: string): Promise<string> {\n  const builtInfoPlistPath = path.join(binaryPath, 'Info.plist');\n  const { CFBundleIdentifier } = await parsePlistAsync(builtInfoPlistPath);\n  return CFBundleIdentifier;\n}\n"],"names":["launchAppAsync","binaryPath","manager","props","appId","profile","getBundleIdentifierForBinaryAsync","isSimulator","device","osType","launchBinaryOnMacAsync","installOnDeviceAsync","bundleIdentifier","bundle","appDeltaDirectory","getAppDeltaDirectory","udid","deviceName","name","XcodeBuild","logPrettyItem","chalk","AppleDeviceManager","resolveAsync","installAppAsync","shouldStartBundler","SimulatorLogStreamer","getStreamer","attachAsync","getDefaultDevServer","openCustomRuntimeAsync","applicationId","builtInfoPlistPath","path","join","CFBundleIdentifier","parsePlistAsync"],"mappings":"AAAA;;;;+BAcsBA,gBAAc;;aAAdA,cAAc;;;8DAdlB,OAAO;;;;;;;8DACR,MAAM;;;;;;kEAEK,cAAc;sCAEiB,oCAAoC;oCAC5D,8CAA8C;2BAC1C,qCAAqC;+BACvC,yCAAyC;uBAE9C,mBAAmB;yBAC3B,qBAAqB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGtC,eAAeA,cAAc,CAClCC,UAAkB,EAClBC,OAAyB,EACzBC,KAAwE,EACxE;IACA,MAAMC,KAAK,GAAG,MAAMC,IAAAA,QAAO,QAAA,EAACC,iCAAiC,CAAC,CAACL,UAAU,CAAC,AAAC;IAE3E,IAAI,CAACE,KAAK,CAACI,WAAW,EAAE;QACtB,IAAIJ,KAAK,CAACK,MAAM,CAACC,MAAM,KAAK,OAAO,EAAE;YACnC,MAAMC,IAAAA,UAAsB,uBAAA,EAACN,KAAK,EAAEH,UAAU,CAAC,CAAC;QAClD,OAAO;YACL,MAAMI,IAAAA,QAAO,QAAA,EAACM,qBAAoB,qBAAA,CAAC,CAAC;gBAClCC,gBAAgB,EAAER,KAAK;gBACvBS,MAAM,EAAEZ,UAAU;gBAClBa,iBAAiB,EAAEC,IAAAA,qBAAoB,qBAAA,EAACX,KAAK,CAAC;gBAC9CY,IAAI,EAAEb,KAAK,CAACK,MAAM,CAACQ,IAAI;gBACvBC,UAAU,EAAEd,KAAK,CAACK,MAAM,CAACU,IAAI;aAC9B,CAAC,CAAC;QACL,CAAC;QAED,OAAO;IACT,CAAC;IAEDC,WAAU,CAACC,aAAa,CAACC,IAAAA,MAAK,EAAA,QAAA,CAAA,CAAC,qBAAqB,EAAElB,KAAK,CAACK,MAAM,CAACU,IAAI,CAAC,CAAC,CAAC,CAAC;IAE3E,MAAMV,MAAM,GAAG,MAAMc,mBAAkB,mBAAA,CAACC,YAAY,CAAC;QAAEf,MAAM,EAAEL,KAAK,CAACK,MAAM;KAAE,CAAC,AAAC;IAC/E,MAAMA,MAAM,CAACgB,eAAe,CAACvB,UAAU,CAAC,CAAC;IAEzCkB,WAAU,CAACC,aAAa,CAACC,IAAAA,MAAK,EAAA,QAAA,CAAA,CAAC,kBAAkB,EAAEb,MAAM,CAACU,IAAI,CAAC,OAAO,EAAEd,KAAK,CAAC,EAAE,CAAC,CAAC,CAAC;IAEnF,IAAID,KAAK,CAACsB,kBAAkB,EAAE;QAC5B,MAAMC,cAAoB,qBAAA,CAACC,WAAW,CAACnB,MAAM,CAACA,MAAM,EAAE;YACpDJ,KAAK;SACN,CAAC,CAACwB,WAAW,EAAE,CAAC;IACnB,CAAC;IAED,MAAM1B,OAAO,CAAC2B,mBAAmB,EAAE,CAACC,sBAAsB,CACxD,WAAW,EACX;QACEC,aAAa,EAAE3B,KAAK;KACrB,EACD;QAAEI,MAAM;KAAE,CACX,CAAC;AACJ,CAAC;AAED,eAAeF,iCAAiC,CAACL,UAAkB,EAAmB;IACpF,MAAM+B,kBAAkB,GAAGC,KAAI,EAAA,QAAA,CAACC,IAAI,CAACjC,UAAU,EAAE,YAAY,CAAC,AAAC;IAC/D,MAAM,EAAEkC,kBAAkB,CAAA,EAAE,GAAG,MAAMC,IAAAA,MAAe,gBAAA,EAACJ,kBAAkB,CAAC,AAAC;IACzE,OAAOG,kBAAkB,CAAC;AAC5B,CAAC"}